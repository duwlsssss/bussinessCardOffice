import{u as X,j as e,H as I,c as D,e as $,g as Y,r as n,a as O,b as H,d as M,R as k,f,h as F,i as q,B as J,V as A,C as Q,k as U,O as Z,S as R,E as ee,l as te,D as se,m as oe,K as re,n as ne,P as ae,o as ie,p as ce}from"./vendor-phSXSHZG.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function p(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=p(s);fetch(s.href,r)}})();function le(){const{progress:t}=X();return e.jsxs(I,{center:!0,children:[t," % loaded"]})}const E=D(t=>({isFocused:!1,focusTarget:null,setFocus:c=>t(()=>({isFocused:!0,focusTarget:c})),clearFocus:()=>t(()=>({isFocused:!1,focusTarget:null}))})),K=D(t=>({playerPosition:{x:0,y:0,z:0},setPlayerPosition:(c,p,a)=>t(()=>({playerPosition:{x:c,y:p,z:a}}))}));$(Y);const T=["안녕안뇽","다음 메시지","마지막 메시지"],ue=({controlsRef:t})=>{const c=n.useRef(),{scene:p,animations:a}=O("./models/dancer.glb"),{actions:s}=H(a,c),{camera:r}=M(),[i,u]=n.useState(null),{setFocus:d}=E(),[m,w]=n.useState(!1),[g,y]=n.useState("twerk");K(l=>l.playerPosition),n.useEffect(()=>{p.traverse(l=>{l.isMesh&&(l.castShadow=!0,l.recieveShadow=!0)})},[p]),n.useEffect(()=>(s[g]&&s[g].reset().fadeIn(.5).play(),()=>{s[g]&&s[g].fadeOut(.5).stop()}),[s,g]);const[P,x]=n.useState(0),[o,b]=n.useState(T[0]),j=()=>{const l=(P+1)%T.length;x(l),b(T[l])},z=()=>{w(!m);const l={x:130,y:80,z:220},C={x:130,y:80,z:180};console.log("npc Click"),d({x:130,y:70,z:120}),!i&&t.current?(u({position:r.position.clone(),target:t.current.target.clone()}),f.to(r.position,{x:l.x,y:l.y,z:l.z,duration:1,ease:"power3.inOut"}),f.to(t.current.target,{x:C.x,y:C.y,z:C.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()}})):i&&t&&t.current&&(f.to(r.position,{x:i.position.x,y:i.position.y,z:i.position.z,ease:"power3.inOut",duration:1}),f.to(t.current.target,{x:i.target.x,y:i.target.y,z:i.target.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()},onComplete:()=>{u(null),clearFocus()}})),y(h=>h==="windmill"?"twerk":"windmill")};return e.jsxs(k,{type:"fixed",name:"NPC",children:[e.jsx("primitive",{scale:.7,ref:c,object:p,position:[130,70,120]}),e.jsxs("mesh",{position:[130,157,120],onClick:z,children:[e.jsx("sphereGeometry",{args:[5,24,24]}),e.jsx("meshStandardMaterial",{color:"blue"})]}),m&&e.jsxs("mesh",{position:[170,115,120],onClick:j,children:[e.jsx("boxGeometry",{args:[5,5,5]}),e.jsx("meshStandardMaterial",{color:"red"})]}),m&&e.jsx(I,{position:[130,130,120],transform:!0,occlude:"blending",geometry:e.jsx("roundedPlaneGeometry",{args:[100,40,10]}),children:e.jsx("div",{className:"speech-bubble-text",children:o})})]})},B=5e5,L=1e6,de=({controlsRef:t})=>{M();const{isFocused:c,clearFocus:p}=E();K(o=>o.setPlayerPosition);const a=n.useRef(),s=n.useRef(),r=n.useRef(null),i=F(o=>o[S.left]),u=F(o=>o[S.right]),d=F(o=>o[S.back]),m=F(o=>o[S.forward]);n.useState(!1);const[w,g]=n.useState(!1),{scene:y,animations:P}=O("./models/standing_55.glb"),{actions:x}=H(P,y);return n.useEffect(()=>{y&&x&&Object.keys(x).length>0&&x.standing_55.play()},[y,x]),y.traverse(o=>{o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0)}),n.useEffect(()=>{const o=m||d||i||u?"walkkk":"standing_55";(!r.current||r.current!==o)&&x[o]&&(r.current&&x[r.current].fadeOut(.2),r.current=o,x[o].reset().fadeIn(.2).play())},[m,d,i,u,x]),q((o,b)=>{if(!c){if(w&&(m||d||i||u))g(!1);else if(w)s.current.setLinvel({x:0,y:0,z:0},!0),s.current.setAngvel({x:0,y:0,z:0},!0);else if(!w){const l={x:0,y:0,z:0},C=i||u||d||m,h=s.current.linvel();let v=!1;if(u&&h.x<L&&(l.x+=B,v=!0),i&&h.x>-L&&(l.x-=B,v=!0),d&&h.z<L&&(l.z+=B,v=!0),m&&h.z>-L&&(l.z-=B,v=!0),C?s.current.applyImpulse(l,!0):s.current.setLinvel({x:0,y:h.y,z:0},!0),v){const N=Math.atan2(h.x,h.z);a.current.rotation.y=N}}const j=a.current.getWorldPosition(new A),z=new A(j.x,j.y+170,j.z+120);o.camera.position.lerp(z,b*20),t&&t.current&&(t.current.target.set(j.x,0,j.z),t.current.update())}}),n.useEffect(()=>{if(y){const o=new J().setFromObject(y),b=new A;o.getSize(b),console.log("Model Height:",b.y)}},[y]),e.jsx(e.Fragment,{children:e.jsxs(k,{name:"Player",ref:s,colliders:!1,enabledRotations:[!1,!1,!1],sclae:[.5,.5,.5],children:[e.jsx(Q,{args:[14,30],position:[0,48,180],onCollisionEnter:o=>{o.rigidBodyObject.name!=="void"&&(console.log("충돌 발생",o.rigidBodyObject.name),g(!0))},onCollisionExit:o=>{o.rigidBodyObject.name!=="void"&&(console.log("충돌 해제",o.rigidBodyObject.name),g(!1))}}),e.jsx("primitive",{object:y,ref:a,scale:35,position:[0,25,180],rotation:[0,180*Math.PI/180,0]})]})})},pe=t=>{const{camera:c}=M(),{setFocus:p,clearFocus:a}=E(),[s,r]=n.useState(null),i={x:-1.6,y:106,z:50},u={x:-1.6,y:106,z:23};return{handleMonitorClick:()=>{console.log("monitor click"),p({x:-1.6,y:106,z:50}),!s&&t.current?(r({position:c.position.clone(),target:t.current.target.clone()}),f.to(c.position,{x:i.x,y:i.y,z:i.z,duration:1,ease:"power3.inOut"}),f.to(t.current.target,{x:u.x,y:u.y,z:u.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()}})):s&&t&&t.current&&(f.to(c.position,{x:s.position.x,y:s.position.y,z:s.position.z,ease:"power3.inOut",duration:1}),f.to(t.current.target,{x:s.target.x,y:s.target.y,z:s.target.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()},onComplete:()=>{r(null),a()}}))}}},fe=t=>{const{camera:c}=M(),{setFocus:p}=E(),[a,s]=n.useState(null),r={x:-270,y:140,z:-100},i={x:-270,y:140,z:-180};return{handleNoticeBoardClick:()=>{console.log("nbClick"),p({x:-270,y:140,z:-100}),!a&&t.current?(s({position:c.position.clone(),target:t.current.target.clone()}),f.to(c.position,{x:r.x,y:r.y,z:r.z,duration:1,ease:"power3.inOut"}),f.to(t.current.target,{x:i.x,y:i.y,z:i.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()}})):a&&t&&t.current&&(f.to(c.position,{x:a.position.x,y:a.position.y,z:a.position.z,ease:"power3.inOut",duration:1}),f.to(t.current.target,{x:a.target.x,y:a.target.y,z:a.target.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()},onComplete:()=>{s(null),clearFocus()}}))}}},xe=({controlsRef:t})=>{const{camera:c}=M(),{setFocus:p,clearFocus:a}=E(),[s,r]=n.useState(null),[i,u]=n.useState(!1),[d,m]=n.useState(null),[w,g]=n.useState(null),[y,P]=n.useState({});n.useEffect(()=>{const z=l=>{l.data.source==="react-devtools-bridge"||l.data.source==="react-devtools-content-script"||(console.log("iframe:",l.data),m(l.data))};return window.addEventListener("message",z),()=>{window.removeEventListener("message",z)}},[]);const x={x:-1.6,y:106,z:100},o={x:-1.6,y:106,z:50};n.useEffect(()=>{d&&(console.log("받은데이터",d),p({x:-1.6,y:106,z:100}),!s&&t.current&&(r({position:c.position.clone(),target:t.current.target.clone()}),f.to(c.position,{x:x.x,y:x.y,z:x.z,duration:1,ease:"power3.inOut"}),f.to(t.current.target,{x:o.x,y:o.y,z:o.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()},onComplete:()=>{setTimeout(()=>u(!0),2e3)}})))},[d,t,s,c]);const b=z=>{const{offsetX:l,offsetY:C,target:h}=z.nativeEvent,{clientWidth:v,clientHeight:N}=h,G=l/v*30-20,W=-(C/N*30-20),_=`${l/5+C/5}%`,V=l/200;P({backgroundPosition:_,filter:`opacity(${V}) brightness(2)`}),g(`perspective(1200px) rotateY(${G}deg) rotateX(${W}deg)`)},j=()=>{s&&t&&t.current&&(f.to(c.position,{x:s.position.x,y:s.position.y,z:s.position.z,ease:"power3.inOut",duration:1}),f.to(t.current.target,{x:s.target.x,y:s.target.y,z:s.target.z,duration:1,ease:"power3.inOut",onUpdate:()=>{t.current.update()},onComplete:()=>{u(!1),a(),r(null),m(null)}}))};return e.jsx(e.Fragment,{children:d&&e.jsx(I,{transform:!0,occlude:!0,position:[-1.6,106.5,40],children:e.jsxs("div",{className:"print-canvas",children:[e.jsx("div",{className:"back",onClick:j,children:"❌"}),e.jsxs("div",{className:"cute-card",style:{transform:w||void 0},onMouseMove:b,children:[e.jsx("div",{className:"overlay"}),e.jsxs("p",{children:["🔖이름: ",d.data.name]}),e.jsxs("p",{children:["📬E-mail: ",d.data.email]}),e.jsxs("p",{children:["🎓학교: ",d.data.school]}),e.jsxs("p",{children:["🥕MBTI: ",d.data.MBTI]}),e.jsxs("p",{children:["🔖IG: ",d.data.ig]})]})]})})})};function me(){const t=O("./models/monitor.glb");O("./models/office.glb"),O("./models/dancer.glb");const c=n.useRef();U(c,se,5,"red");const p=n.useRef();U(p,oe,5,"red");const a=n.useRef(),{handleMonitorClick:s}=pe(a),{handleNoticeBoardClick:r}=fe(a),i=O("models/map.glb");return n.useEffect(()=>{i.scene.traverse(u=>{u.isMesh&&(u.castShadow=!0,u.receiveShadow=!0)})}),e.jsxs(e.Fragment,{children:[e.jsx(Z,{ref:a}),e.jsx("axesHelper",{args:[500,500,500]})," ",e.jsx(R,{}),e.jsx(ee,{preset:"forest",background:!0}),e.jsx("directionalLight",{ref:c,intensity:1,position:[-100,400,0],color:"#fdfbfb",castShadow:!0,"shadow-camera-left":-500,"shadow-camera-right":500,"shadow-camera-top":500,"shadow-camera-bottom":-500,"shadow-camera-near":10,"shadow-camera-far":1e3,"shadow-mapSize-width":1e4,"shadow-mapSize-height":1e4}),e.jsx(k,{type:"fixed",children:e.jsx(I,{className:"monitorScreen",transform:!0,occlude:"blending",position:[-1.6,106.5,24],children:e.jsx("iframe",{src:"https://kimmyungsa.netlify.app",style:{width:"1600px",height:"1200px"}})})}),e.jsx(k,{type:"fixed",scale:1.8,position:[-110,-10,90],rotation:[0,-90*Math.PI/180,0],children:e.jsx("primitive",{object:t.scene,onClick:s})}),e.jsxs(k,{colliders:!1,type:"fixed",name:"void",children:[e.jsxs("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[500,500]}),e.jsx("meshBasicMaterial",{color:"#e3daf7"})]}),e.jsx(te,{position:[0,0,0],args:[500,0,500]})]}),e.jsxs("mesh",{onClick:r,position:[-260,150,-200],children:[e.jsx("boxGeometry",{args:[10,10,10]}),e.jsx("meshStandardMaterial",{color:"orange"})]}),e.jsx(ue,{controlsRef:a}),e.jsx(de,{controlsRef:a}),e.jsx(xe,{controlsRef:a})]})}const S={forward:"forward",back:"back",left:"left",right:"right"};function ge(){const t=n.useMemo(()=>[{name:S.forward,keys:["ArrowUp","KeyW"]},{name:S.back,keys:["ArrowDown","KeyS"]},{name:S.left,keys:["ArrowLeft","KeyA"]},{name:S.right,keys:["ArrowRight","KeyD"]}],[]);return e.jsx(re,{map:t,children:e.jsx(ne,{shadows:!0,camera:{position:[0,200,400],fov:75,near:.1,far:5e3},children:e.jsx(n.Suspense,{fallback:e.jsx(le,{}),children:e.jsx(ae,{debug:!0,children:e.jsx(me,{})})})})})}ie.createRoot(document.getElementById("root")).render(e.jsx(ce.StrictMode,{children:e.jsx(ge,{})}));
